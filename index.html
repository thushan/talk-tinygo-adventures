<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>IoT Adventures with TinyGo</title>
	<link rel="stylesheet" href="engine/reset.css">
	<link rel="stylesheet" href="engine/reveal.css">
	<link rel="stylesheet" href="engine/theme/black.css" id="theme">
	<link rel="stylesheet" href="engine/plugin/highlight/monokai.css" id="highlight-theme">
	<link rel="stylesheet" href="engine/2shan.css">
	<style>
		.tinygo-blue 
		{
			color: #1B8BEB;
		}
		.golang-blue 
		{
			color: #00AED8;
		}
	</style>
</head>
<body>
	<div class="reveal">
		<div class="slides">
			<section data-markdown>
				## IoT Adventures in TinyGo
				Thushan Fernando

				![TinyGo logo](assets/tinygo-logo.png)

				[@thushanfernando](https://twitter.com/thushanfernando)

				[github.com/thushan](https://github.com/thushan)
			</section>
			<section>
				<p>TinyGo is <strong class="golang-blue">Go</strong> for <strong class="tinygo-blue">Tiny</strong> devices.</p>
				<p>&nbsp;</p>
				<p class="fragment">...also for WebAssembly (WASM) and CLI Tools.</p>
				<p class="fragment fade-up">Thanks! Tiny Presentation! Questions?</p>
				<p class="fragment fade-in-then-out"><em>Just Joking!</em></p>
			</section>
			<section> <!-- What is Go? -->
				<section>
					<p><img src="assets/img/golang-gopher.png"></p>
					<p>Don't know Go?</p>
					<p class="fragment">Don't go! We'll cover it lightly.</p>
				</section>
				<section>
					<p><strong class="golang-blue">Go</strong> was created by <span style="color: #4285F4;">G</span><span style="color: #DB4437;">o</span><span style="color: #F4B400;">o</span><span style="color: #4285F4;">g</span><span style="color: #0F9D58;">l</span><span style="color: #DB4437;">e</span> in 2007.</p>
					<p class="fragment">
						<img src="assets/img/go-authors.jpg"><br/>
						By <strong>Robert Griesemer, Rob Pike & Ken Thompson</strong>...
					</p>
					<p class="fragment">...who disliked the <a href="https://talks.golang.org/2012/splash.article#:~:text=The%20goals%20of%20the%20Go,and%20maintain%E2%80%94large%20software%20systems." class="learn-more">chaos of C++ at Google</a>.</p>
					<p class="fragment"><strong>v1.0</strong> was released in 2012, latest is <a href="https://golang.org/doc/devel/release.html#go1.15">v1.15.2</a>.</p>
				</section>
				<section>					
					<p> <h3>Features of Golang</h3>
						<ul>
							<li>statically typed, easy to follow language</li>
							<li>extremely fast compilation</li>
							<li>efficient execution on modern multicore systems</li>
							<li>built-in concurrency & garbage collection</li>
							<li>reliable dependency management - <code>go get</code></li>
							<li>built in testing, profiling & race condition checking</li>
							<li>opinionated - <code>GoDoc, gofmt</code></li>
						</ul>
					</p>
				</section>
				<section>
					<h3>Simplest Go Program</h3>
					<pre><code data-trim data-noescape class="language-go" data-line-numbers="1|2|3|4">
							package main
							import "fmt"
							func main() {
								fmt.Println("Hello Voyager!")
							}
						</code></pre>
					<pre class="console-commands">
					$ go run hello-voyager.go
					> Hello Voyager!
					</pre>	
				</section>
				<section>
					<h3>Take a...</h3>
					<p><img src="assets/img/animated-gopher.gif" width="400" height="400"> </p>
					<p><a href="https://tour.golang.org/welcome/1" class="learn-more">Tour of Go...</a></p>
				</section>
			</section>
			<section> <!-- What is Tiny? -->
				<section>
					<h3>What's Tiny then?</h3>
					<p class="fragment">
						<img src="assets/img/raspberrypi-4.png">
					</p>
					<p class="fragment">...It's small, but we want Tiny.</p>
				</section>
				<section>
					<h3>Devices like...</h3>
				</section>
				<section>					
					<h3>Arduino Uno / Nano</h3>
					<p>
						<img src="assets/img/arduino-uno.png"> <img src="assets/img/arduino-nano.png">
					</p>					
					<p>
						Read the <a href="https://core-electronics.com.au/tutorials/history-of-arduino.html" class="learn-more">History of Arduino</a>
					</p>
				</section>
				<section>					
					<h3>Arduino Nano 33 - IoT | BLE | Sense</h3>
					<p>
						<img src="assets/img/arduino-nano-33-iot.jpg"> <img src="assets/img/arduino-nano-33-ble.jpg"> <img src="assets/img/arduino-nano-33-ble-sense.jpg">
					</p>
					<p>
						Newest, most powerful Arduino for Modern IoT makers.
					</p>			
				</section>
				<section>
					<h3>Teensy</h3>					
					<p>
						<img src="assets/img/teensy3.2.png">
					</p>
				</section>
				<section>
					<h3>ESP8266 / ESP32</h3>					
					<p>
						<img src="assets/img/esp8266.png"> <img src="assets/img/tinygo-esp32-ledstrip.gif">
					</p>
					<p class="fragment">...Boring? But wait...</p>
				</section>
				<section>
					<h3>Gameboy Advance</h3>					
					<p>
						<img src="assets/img/tinygo-gameboy-advance.gif">
					</p>
				</section>
				<section>
					<h3>Nintendo Switch</h3>					
					<p>
						<img src="assets/img/tinygo-nintendo-switch.gif"> <img src="assets/img/geoff-polzin.png">
					</p>
				</section>
				<section>
					<h2>Tiny Devices</h2>
					<table class="font-xlarge table-data-align-center">
						<thead>
							<tr>
								<th></th>
								<th>Arduino Uno</th>
								<th>Arduino Nano</th>
								<th>33 IoT</th>
								<th>33 BLE</th>
								<th>33 BLE Sense</th>
								<th>Teensy v4</th>
								<th>ESP8266</th>
								<th>ESP32</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th>Controller</th>
								<td>ATmega32P</td>
								<td>ATmega32P</td>
								<td>SAMD21</td>
								<td>nRF52840</td>
								<td>nRF52840</td>
								<td>CortexM4</td>
								<td>L106</td>
								<td>XtensaLX6</td>
							</tr>
							<tr>
								<th>Type</th>
								<td>8-bit</td>
								<td>8-bit</td>
								<td>32-bit</td>
								<td>32-bit</td>
								<td>32-bit</td>
								<td>32-bit</td>
								<td>32-bit</td>
								<td>32-bit</td>
							</tr>
							<tr>
								<th>Instructions</th>
								<td>AVR</td>
								<td>AVR</td>
								<td>ARM</td>
								<td>ARM</td>
								<td>ARM</td>
								<td>ARM</td>
								<td>AT</td>
								<td>ULP</td>
							</tr>
							<tr>
								<th>Cores</th>
								<td>1</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
								<td>2</td>
							</tr>
							<tr>
								<th>Clock</th>
								<td>16Mhz</td>
								<td>16Mhz</td>
								<td>48Mhz</td>
								<td>64Mhz</td>
								<td>64Mhz</td>
								<td class="highlight-green">600Mhz</td>
								<td>80Mhz</td>
								<td>160Mhz</td>
							</tr>						
							<tr>
								<th>EEPROM / SRAM (kb)</th>
								<td>1.1</td>
								<td>1.0</td>
								<td>32</td>
								<td>256</td>
								<td>256</td>
								<td>1024</td>
								<td>64</td>
								<td>520</td>
							</tr>				
							<tr>
								<th>Flash (kb)</th>
								<td>1.1</td>
								<td>1.0</td>
								<td>256</td>
								<td>1024</td>
								<td>1024</td>
								<td>2048</td>
								<td>4096</td>
								<td>4096</td>
							</tr>
						</tbody>
					</table>
					<p class="fragment">Every tiny bit counts!</p>
				</section>
			</section>
			<section> <!-- TinyGo -->
				<section>
					<h3>So I can Go on Tiny Devices?</h3>
					<p class="fragment">Go was <span class="highlight-pink">designed for speed</span>, not size.</p>
					<p class="fragment">
						<img src="assets/img/vb6-compile-for-speed-vs-small.gif">
					</p>
					<p class="fragment">We need something <span class="highlight-green">optimised for size</span>.</p>
				</section>
				<section>
					<h3>So Back to TinyGo</h3>
					<p class="fragment">Created by <a href="https://aykevl.nl/" class="learn-more">Ayke van Laëthem</a>!</p>
					<p class="fragment">It's an LLVM based Compiler</p>
					<p class="fragment">Supports a <a href="https://tinygo.org/lang-support/" class="learn-more">subset of Go</a> language & <a href="https://tinygo.org/compiler-internals/datatypes/" class="learn-more">data types</a></p>
					<p class="fragment">And a smaller set of <a href="https://tinygo.org/lang-support/stdlib/" class="learn-more">standard packages</a></p>
					<p class="fragment">To make lean binaries to fit into tiny devices</p>
					<p class="fragment">And binaries for Linux, WASM & one-day Windows!</p>
				</section>
			</section>
			<section>				
				<section>
					<h3>How Tiny Are We Talking?</h3>
					<img src="assets/img/arrested-development-tinytown.jpg">
					<p class="fragment">Let's find out...</p>					
				</section>
				<section>
					<h3><span class="golang-blue">Go</span> vs <span class="tinygo-blue">TinyGo</span> Binary Size</h3>
					<pre><code data-trim data-noescape class="language-go">
						package main

						func main() {
							println("Hello Voyager!")
						}
					</code></pre>
					
					<pre class="console-commands highlight-yellow">$ make build-tinygo-comparison
					</pre>
					<pre class="console-commands fragment">1.1M build/hello-voyager_golang
					21K  build/hello-voyager_tinygo
					</pre>
					<p class="fragment">
						<img src="assets/img/memes/chris-pratt-omg.gif">
					</p>
				</section>
			</section>
			</section>
			<section>
				<h3>What is this voodoo magic?</h3>				
				<p class="fragment">
					<img src="assets/img/tinygo-compiler.png">

				</p>
				<p class="fragment">TinyGo relies on the existing Go toolchain</p>
				<p class="fragment">After the <a href="https://github.com/golang/go/blob/master/src/cmd/compile/internal/ssa/README.md" class="learn-more">Go SSA</a> phase, it has a <em>go</em> at trimming</p>
				<p class="fragment">Prunes & optimises for target architecture</p>
			</section>
			<section><!-- Get Started -->
				<section>
					<h3>Let's Get Started</h3>
					<h5>Windows</h5>
					<pre class="console-commands highlight-yellow">
						$ scoop install tinygo
					</pre>
					<h5>Mac</h5>
					<pre class="console-commands highlight-yellow">
					$ brew tap  tinygo-org/tools
					$ brew install tinygo
					</pre>
					<h5>Linux</h5>
					<pre class="console-commands highlight-yellow">
						$ wget https://github.com/tinygo-org/tinygo/releases/download/v0.15.0/tinygo_0.15.0_amd64.deb
						$ sudo dpkg -i tinygo_0.15.0_amd64.deb
					</pre>
				</section>
				<section>
					<h3>Let's also install <code>avr-dude</code></h3>
					Programs our Arduino Atmel AVR MCU. <br/> <br/>
					<h5>Windows</h5>
					<pre class="console-commands highlight-yellow">
						$ scoop install avr-dude
					</pre>
					<h5>Mac</h5>
					<pre class="console-commands highlight-yellow">
						$ brew install avrdude
					</pre>
					<h5>Linux</h5>
					<pre class="console-commands highlight-yellow">
						$ sudo apt-get install gcc-avr avr-libc avrdude
					</pre>
				</section>
				<section>
					<h3>One more thing on Windows...</h3>
					<h5>Windows</h5>
					<pre class="console-commands highlight-yellow">
						$ choco install make
					</pre>
					<p class="fragment">There's a joke in there somewhere...</p>
				</section>
			</section>
			<section> <!-- Examples Prep -->
				<section>
					<h3>Let's see some examples</h3>
					<p>First how the examples are structured:</p>
					<p>
						<pre>
├── /_build
├── /blink-bling
│   └── main.go
├── /blink-ello
│   └── main.go
├── /distance-sensor
│   └── main.go
├── /go-compare
│   └── main.go
├── /temp-sensor
|   └── main.go
├── Makefile
├── go.mod
├── go.sum
└── platformio.ini
						</pre>
					</p>
					<p>Let's <code class="highlight-blue">make</code> them work.</p>
				</section>
				<section>
					<h3>Make makes it easy</h3>
					<p>All examples have a <code class="highlight-blue">make</code> target.</p>
					<p>
						<pre class="console-commands highlight-yellow">
							$ make build-arduino-blink-ello
							$ make flash-arduino-blink-ello
						</pre>
					</p>
					<p>Another target to clean our build artefacts.</p>					
					<p>
						<pre class="console-commands highlight-yellow">
							$ make clean
						</pre>
					</p>
					<p>Easy to present, easy to try later.</p>
				</section>
			</section>
			<section> <!-- Example: Blinky-->
				<section>
					<h3>Arduino Target Examples</h3>
					<p>Our <span class="highlight-green">Target</span> board is Arduino based.</p>
					<p class="fragment">Widely used, based on the <code>AVR</code> Instruction set</p>
					<p class="fragment">That's why we installed <code>avr-dude</code> earlier.</p>
					<p class="fragment">Let's look at <a href="https://tinygo.org/microcontrollers/arduino-uno/" class="learn-more">Arduino Uno</a> support.</p>
				</section>
				<section>
					<h3>Token Hello World</h3>
					<p>Let's make something blink - <code class="highlight-purple">blink-ello</code>.</p>
					<p>
						<img src="assets/img/arduino-blink.gif">
					</p>
					<p>
						<pre class="console-commands highlight-yellow">
							$ make build-arduino-blink-ello
							$ make flash-arduino-blink-ello
						</pre>
					</p>
					<p class="fragment">
						<img src="assets/img/memes/overacting-omg.gif">
					</p>
				</section>
				<section>
					<h3>Machine Package</h3>
					<p>This is the Hardware Abstraction Layer in TinyGo</p>
					<p class="fragment">Defines all our board hardware - pins, buses, sensors</p>
					<p class="fragment">Let's look at <a href="https://tinygo.org/microcontrollers/machine/arduino/" class="learn-more">Arduino Machine</a> specifications.</p>
				</section>
			</section>
			<section> <!-- Blinky Bling -->
				<section>
					<h3>Blink with some Bling</h3>
					<p>Let's make something blink - <code class="highlight-purple">blink-bling</code>.</p>
					<p>
						<img src="assets/img/examples/blink-bling.png">
					</p>
					<p>
						<pre class="console-commands highlight-yellow">
							$ make flash-arduino-blink-bling
						</pre>
					</p>
					<p class="fragment">
						<img src="assets/img/memes/get-out-seinfeld.gif">
					</p>
				</section>
				<section>
					<h3>Go routines in TinyGo</h3>
					<p>...are a big thing!</p>
					<p class="fragment">We specified a scheduler when flashing</p>
					<p>
						<pre class="console-commands highlight-yellow">
							$ tinygo flash -target arduino -scheduler coroutines ...
						</pre>
					</p>
					<p class="fragment">
						Which does the hard work of concurrency
					</p>
					<p class="fragment">
						Well supported on <code>ARCM</code>, still improving on <code>AVR</code>.
					</p>
					<p class="fragment">
						Opens up a whole host of new ideas.
					</p>
				</section>
			</section>
			<section> <!-- Temp Sensor -->
				<section>
					<h3>Using Drivers in TinyGo</h3>
					<p>Let's use the <a href="https://www.adafruit.com/product/2652" class="learn-more">BME280</a> sensor - <code class="highlight-purple">temp-sensor</code>.</p>
					<p>
						<pre class="console-commands highlight-yellow">
							$ make flash-arduino-temp-sensor
						</pre>
					</p>
					<p class="fragment">
						<img src="assets/img/examples/BME280-Arduino-Schematic.png">
					</p>
					<p>Gives us Temperature, Humidity & Altitude.</p>
				</section>
				<section>
					<h3>Drivers Package</h3>
					<p>Drivers are a go module.</p>
					<p>
						<pre class="console-commands highlight-yellow">
							$ go get tinygo.org/x/drivers
						</pre>
					</p>
					<p class="fragment">
						There's a host of common devices supported already. <br/>
						Sensors, LEDs/Smart Displays, RTCs, GPS.
					</p>
					<p class="fragment">
						Take a look at <a href="https://tinygo.org/microcontrollers/drivers/" class="learn-more">Supported Hardware Devices</a>(53).
					</p>
				</section>
			</section>
			<section>
				<section>
					<h3>TinyGo is still maturing</h3>
					<p class="fragment">
						There's still a few things to implement in TinyGo.
					</p>
					<p class="fragment">
						It's a good way to learn Go
					</p>					
				</section>
				<section>
					<h3>Slides, Resources etc</h3>
					<p>
						<a href="https://github.com/thushan">github.com/thushan/talk-tinygo-adventures</a>
					</p>
					<p class="fragment">
						Thanks! Questions?
					</p>
				</section>
			</section>
		</div>
	</div>

	<script src="engine/reveal.js"></script>
	<script src="engine/plugin/chart/chart.min.js"></script>
	<script src="engine/plugin/chart/plugin.js"></script>
	<script src="engine/plugin/chalkboard/plugin.js"></script>
	<script src="engine/plugin/notes/notes.js"></script>
	<script src="engine/plugin/markdown/markdown.js"></script>
	<script src="engine/plugin/highlight/highlight.js"></script>
	<script>
		Reveal.initialize({
			hash: true,
			chart: {
				defaults: {
					global: {
						title: { fontColor: "#FFF" },
						legend: {
							labels: { fontColor: "#FFF" },
						},
					},
					scale: {
						scaleLabel: { fontColor: "#FFF" },
						gridLines: { color: "#FFF", zeroLineColor: "#FFF" },
						ticks: { fontColor: "#FFF" },
					}
				},
				line: { borderColor: ["rgba(20,220,220,.8)", "rgba(220,120,120,.8)", "rgba(20,120,220,.8)"], "borderDash": [[5, 10], [0, 0]] },
				bar: { backgroundColor: ["rgba(20,220,220,.8)", "rgba(220,120,120,.8)", "rgba(20,120,220,.8)"] },
				pie: { backgroundColor: [["rgba(0,0,0,.8)", "rgba(220,20,20,.8)", "rgba(20,220,20,.8)", "rgba(220,220,20,.8)", "rgba(20,20,220,.8)"]] },
				radar: { borderColor: ["rgba(20,220,220,.8)", "rgba(220,120,120,.8)", "rgba(20,120,220,.8)"] },
			},
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealChart, RevealChalkboard]
		});
	</script>
</body>

</html>